---
title: Bi·∫øn m√¥i tr∆∞·ªùng
description: B·∫Øt ƒë·∫ßu v·ªõi Create T3 App
layout: ../../../layouts/docs.astro
lang: vi
isMdx: true
---

import Callout from "../../../components/docs/callout.tsx";

Create T3 App s·ª≠ d·ª•ng m·ªôt th∆∞ vi·ªán t·ª± t·∫°o t√™n l√† [@t3-oss/env-nextjs](https://env.t3.gg) c√πng v·ªõi [zod](https://zod.dev) ƒë·ªÉ x√°c th·ª±c bi·∫øn m√¥i tr∆∞·ªùng trong th·ªùi gian ch·∫°y (runtime) _v√†_ th·ªùi gian x√¢y d·ª±ng (buildtime) b·∫±ng c√°ch cung c·∫•p m·ªôt logic ƒë∆°n gi·∫£n trong `src/env.js`.

## env.js

_TLDR; N·∫øu b·∫°n mu·ªën th√™m m·ªôt bi·∫øn m√¥i tr∆∞·ªùng m·ªõi, b·∫°n ph·∫£i th√™m m·ªôt validator trong `src/env.js`, v√† sau ƒë√≥ th√™m ch√∫ng v√†o trong `.env`_

```ts:env.js
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const env = createEnv({
  server: {
    NODE_ENV: z.enum(["development", "test", "production"]),
  },
  client: {
    // NEXT_PUBLIC_CLIENTVAR: z.string(),
  },
  runtimeEnv: {
    NODE_ENV: process.env.NODE_ENV,
  },
});
```

T3 Env s·ª≠ d·ª•ng h√†m `createEnv` ƒë·ªÉ t·∫°o schema v√† x√°c th·ª±c c·∫£ bi·∫øn m√¥i tr∆∞·ªùng cho c·∫£ client-side v√† server-side.

<Callout type="info">
  ƒê·ªÉ bi·∫øt th√™m th√¥ng tin v·ªÅ c√°ch `createEnv` ho·∫°t ƒë·ªông b√™n trong, h√£y tham kh·∫£o
  t√†i li·ªáu c·ªßa [T3 Env](https://env.t3.gg/docs/introduction)
</Callout>

## S·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng

Khi b·∫°n mu·ªën s·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng c·ªßa b·∫°n, b·∫°n c√≥ th·ªÉ nh·∫≠p ch√∫ng t·ª´ t·∫≠p tin ƒë√£ t·∫°o `env.js` v√† s·ª≠ d·ª•ng ch√∫ng nh∆∞ b·∫°n th∆∞·ªùng l√†m. N·∫øu b·∫°n nh·∫≠p ch√∫ng tr√™n client v√† c·ªë g·∫Øng truy c·∫≠p v√†o m·ªôt bi·∫øn m√¥i tr∆∞·ªùng server-side, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c m·ªôt l·ªói th·ªùi gian ch·∫°y.

```ts:pages/api/hello.ts
import { env } from "../../env.js";

// `env` ƒë·∫£m b·∫£o typesafe v√† cung c·∫•p t·ª± ƒë·ªông ho√†n t·∫•t
const dbUrl = env.DATABASE_URL;
```

```ts:pages/index.tsx
import { env } from "../env.js";

// ‚ùå S·∫Ω t·∫°o ra m·ªôt l·ªói th·ªùi gian ch·∫°y
const dbUrl = env.DATABASE_URL;

// ‚úÖ ƒê·ªß wow r·ªìi ƒë√≥
const wsKey = env.NEXT_PUBLIC_WS_KEY;
```

## .env.example

V√¨ t·∫≠p tin `.env` m·∫∑c ƒë·ªãnh kh√¥ng ƒë∆∞·ª£c commit v√†o version control, ch√∫ng t√¥i c≈©ng ƒë√£ bao g·ªìm m·ªôt t·∫≠p tin `.env.example`, trong ƒë√≥ b·∫°n c√≥ th·ªÉ t√πy ch·ªçn gi·ªØ m·ªôt b·∫£n sao c·ªßa t·∫≠p tin `.env` c·ªßa b·∫°n m√† kh√¥ng ƒë·ªÉ l·ªô b·∫•t k√¨ th√¥ng tin n√†o b√≠ m·∫≠t. ƒêi·ªÅu n√†y kh√¥ng b·∫Øt bu·ªôc, nh∆∞ng ch√∫ng t√¥i khuy√™n b·∫°n n√™n gi·ªØ file n√†y ƒë·ªÉ d·ªÖ d√†ng h∆°n cho ng∆∞·ªùi ƒë√≥ng g√≥p b·∫Øt ƒë·∫ßu v·ªõi m√¥i tr∆∞·ªùng c·ªßa h·ªç.

M·ªôt s·ªë framework v√† c√¥ng c·ª• build, nh∆∞ Next.js, khuy√™n b·∫°n n√™n l∆∞u tr·ªØ b√≠ m·∫≠t trong t·∫≠p tin `.env.local` v√† commit t·∫≠p tin `.env` v√†o project. Ch√∫ng t√¥i kh√¥ng khuy·∫øn kh√≠ch ƒëi·ªÅu n√†y, v√¨ n√≥ c√≥ th·ªÉ l√†m cho vi·ªác commit b√≠ m·∫≠t v√†o project tr·ªü n√™n d·ªÖ d√†ng h∆°n. Thay v√†o ƒë√≥, ch√∫ng t√¥i khuy√™n b·∫°n n√™n l∆∞u tr·ªØ b√≠ m·∫≠t trong `.env`, gi·ªØ t·∫≠p tin `.env` c·ªßa b·∫°n trong `.gitignore` v√† ch·ªâ commit t·∫≠p tin `.env.example` v√†o project.

## Th√™m bi·∫øn m√¥i tr∆∞·ªùng

ƒê·ªÉ ƒë·∫£m b·∫£o r·∫±ng qu√° tr√¨nh build c·ªßa b·∫°n kh√¥ng th·ªÉ ho√†nh th√†nh n·∫øu kh√¥ng c√≥ c√°c bi·∫øn m√¥i tr∆∞·ªùng m√† project c·∫ßn, b·∫°n s·∫Ω c·∫ßn th√™m bi·∫øn m√¥i tr∆∞·ªùng m·ªõi v√†o **hai** v·ªã tr√≠:

üìÑ `.env`: Nh·∫≠p bi·∫øn m√¥i tr∆∞·ªùng c·ªßa b·∫°n nh∆∞ b·∫°n d∆∞·ªõi d·∫°ng `KEY=VALUE` trong t·∫≠p tin `.env`

üìÑ `env.js`: Th√™m logic x√°c th·ª±c th√≠ch h·ª£p cho c√°c bi·∫øn m√¥i tr∆∞·ªùng b·∫±ng c√°ch ƒë·ªãnh nghƒ©a m·ªôt schema Zod b√™n trong `createEnv` cho m·ªói bi·∫øn, v√≠ d·ª•: `KEY: z.string()`. Ngo√†i ra, h√£y ƒë·∫£m b·∫£o r·∫±ng b·∫°n th√™m ch√∫ng trong t√πy ch·ªçn `runtimeEnv`, v√≠ d·ª•: `KEY: process.env.KEY`

<Callout type="info">
  T·∫°i sao t√¥i c·∫ßn ph√¢n th√™m bi·∫øn m√¥i tr∆∞·ªùng trong `runtimeEnv`? ƒêi·ªÅu n√†y l√† do
  c√°ch Next.js ƒë√≥ng g√≥i bi·∫øn m√¥i tr∆∞·ªùng trong c√°c runtime nh·∫•t ƒë·ªãnh. B·∫±ng c√°ch
  n√†y, b·∫°n ƒë·∫£m b·∫£o r·∫±ng bi·∫øn s·∫Ω kh√¥ng bao gi·ªù b·ªã lo·∫°i b·ªè kh·ªèi bundle.
</Callout>

T√πy ch·ªçn, b·∫°n c≈©ng c√≥ th·ªÉ gi·ªØ t·∫≠p tin `.env.example` c·∫≠p nh·∫≠t:

üìÑ `.env.example`: Nh·∫≠p bi·∫øn m√¥i tr∆∞·ªùng c·ªßa b·∫°n, nh∆∞ng h√£y ƒë·∫£m b·∫£o r·∫±ng b·∫°n kh√¥ng bao g·ªìm gi√° tr·ªã n·∫øu n√≥ l√† b√≠ m·∫≠t, t·ª©c l√† `KEY=VALUE` ho·∫∑c `KEY=`

### V√≠ d·ª•

_T√¥i mu·ªën th√™m bi·∫øn m√¥i tr∆∞·ªùng c·ªßa Twitter API v√†o bi·∫øn m√¥i tr∆∞·ªùng server-side_

1. Th√™m bi·∫øn m√¥i tr∆∞·ªùng v√†o `.env`:

```
TWITTER_API_TOKEN=1234567890
```

2. Th√™m bi·∫øn m√¥i tr∆∞·ªùng v√†o `env.js`:

```ts
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const env = createEnv({
  server: {
    TWITTER_API_TOKEN: z.string(),
  },
  // ...
  runtimeEnv: {
    // ...
    TWITTER_API_TOKEN: process.env.TWITTER_API_TOKEN,
  },
});
```

3. _T√πy ch·ªçn:_ Th√™m bi·∫øn m√¥i tr∆∞·ªùng v√†o `.env.example` v√† ƒë·∫£m b·∫£o r·∫±ng b·∫°n kh√¥ng bao g·ªìm gi√° tr·ªã b√≠ m·∫≠t trong t√πy ch·ªçn `runtimeEnv`

```bash
TWITTER_API_TOKEN=
```

## √âp ki·ªÉu bi·∫øn

T·∫•t c·∫£ c√°c bi·∫øn m√¥i tr∆∞·ªùng b·∫°n th√™m v√†o `.env` s·∫Ω ƒë∆∞·ª£c nh·∫≠p d∆∞·ªõi d·∫°ng chu·ªói, ngay c·∫£ khi gi√° tr·ªã c·ªßa ch√∫ng ƒë∆∞·ª£c d·ª± ƒë·ªãnh ƒë·∫°i di·ªán cho m·ªôt ki·ªÉu kh√°c. N·∫øu b·∫°n mu·ªën s·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng c·ªßa b·∫°n d∆∞·ªõi d·∫°ng ki·ªÉu kh√°c t·∫°i th·ªùi gian ch·∫°y, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `zod.coerce` ƒë·ªÉ chuy·ªÉn ƒë·ªïi chu·ªói th√†nh ki·ªÉu b·∫°n mu·ªën. N√≥ s·∫Ω b√°o l·ªói n·∫øu √©p ki·ªÉu kh√¥ng th√†nh c√¥ng.

Th√™m bi·∫øn m√¥i tr∆∞·ªùng v√†o `.env`:

```
SOME_NUMBER=123
SOME_BOOLEAN=true
```

Sau ƒë√≥, x√°c th·ª±c ch√∫ng trong `env.js`:

```ts
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const env = createEnv({
  server: {
    SOME_NUMBER: z.coerce.number(),
    SOME_BOOLEAN: z.coerce.boolean(),
  },
  // ...
  runtimeEnv: {
    SOME_NUMBER: process.env.SOME_NUMBER,
    SOME_BOOLEAN: process.env.SOME_BOOLEAN,
  },
});
```
